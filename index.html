<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Boo</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<style type="text/css">
	body{
		width: :100%;
		height: :100%;
		position: relative;
	}
	.wrap{
		width: 300px;
		position: absolute;
		top:50px;
		left: 50%;
		margin-left: -250px;
	}
	.wrap img{
		display: block;
		width: 100%;
	}
	/*#canvas{
		width: 300px;
		height: 300px;
	}*/
</style>
</head>
<body>
    <div class="wrap">
    	<img src="img/a.jpg"/>
    </div>
    <section><canvas id="canvas7" width="960" height="640"></canvas></section>

</body>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript">
		var Boom = {
				width:null,
				height:null,
				imgWidth:null,
				imgHeight:null,
				minWidth:null,
				minHeight:null,
				rowCols:[5,5],//行列
				position:[], //[{x: , y: },...]
				boomPosition:[],
				boomXY:[0,0],//爆炸的中心点
				boomWidth:50,
				boomTime:100,
				beforeFn:function(){
					console.log("准备爆炸~");
				},
				callback:function(){
					console.log("爆炸结束！");
				},
				init:function(o){
					// 入口函数
					if(!o || !o.imgDom || !o.wrapDom){
						return "请输入图片节点";
					}else{
						var $img = o.imgDom;

						this.imgDom = o.imgDom;
						this.wrapDom = o.wrapDom;
						this.imgSrc = o.imgDom.attr('src');

						this.width = $img.css('width').split('px')[0];
						this.height = $img.css('height').split('px')[0];

						if(o.wrapDom.css('position') !== 'relative' && o.wrapDom.css('position') !== 'absolute'){
							o.wrapDom.css('position','relative');
						}

						this.getOriData();
						this.getPosition();
						this.domForPiece();
						this.bindEvent();
					}
				},
				getOriData:function(){
					var that = this;
					$("<img/>").attr("src", that.imgSrc).load(function() {
							that.imgWidth = this.width;
							that.imgHeight = this.height;
					});
				},
				getPosition:function(){
					var x = 0,
						y = 0;

					this.minWidth = Math.round(this.width / this.rowCols[0]);
					this.minHeight = Math.round(this.height / this.rowCols[1]);
					//计算每块的x,y,存进position数组 
					for(var i = 0; i < this.rowCols[0]; i++){
						x = i * this.minWidth;

						for(var j = 0; j < this.rowCols[1]; j++){
							y = j * this.minHeight;
							this.position.push({x:x,y:y});
							this.boomPosition.push({
								x:x + parseInt(this.minWidth/2) - ( this.width / 2 ),
								y:y + parseInt(this.minHeight/2) - ( this.height /2 )
							});//相对于中心点的位置坐标
						}

					}	

					//计算最终每块的left，top坐标
					(function(arr,that){
						var new_arr = [],
							x,
							y,
							param;

						for(var i = 0, len = arr.length; i < len; i++ ){
						 	param = parseFloat(arr[i].y/arr[i].x).toFixed(3);
						 	x = arr[i].x + ( arr[i].x > 0 ? that.boomWidth : - that.boomWidth );
						 	y = param * x;
						 	new_arr.push({
						 		x:x + that.width / 2 + parseInt(Math.random()* 200),//纠正偏移坐标 + 随机位置抖动
						 		y:y + that.height / 2 + parseInt(Math.random()* 50)
						 	});
						}

						that.boomPosition = new_arr;

					})(this.boomPosition,this);			
				},
				domForPiece:function(){
					//写入html 
					var str = '';

					for(var i = 0; i < this.position.length; i++){
						str += '<div style="width:' + this.minWidth + 'px;height:' + this.minHeight + 'px;position:absolute;top:' + this.position[i].y + 'px;left:' + this.position[i].x + 'px;overflow:hidden;">'
								+ '<img src="' + this.imgSrc + '" style="display:block;width:' + this.width + 'px;position:absolute;left:-' + this.position[i].x + 'px;top:-' + this.position[i].y + 'px;"/>'
							+ '</div>';
					}

					this.imgDom.hide();
					this.wrapDom.append(str);
				},
				bindEvent:function(){
					var that = this;
					// 绑定事件
					this.wrapDom.on('click',function(){
						var flag;

						if($(this).data('run')){
							flag = false;
							$(this).data('run',false);
						}else{
							flag = true;
							$(this).data('run',true);
						}

						that.runBoo(flag);
					});
				},
				runBoo:function(flag){
					var that = this,
						dom = that.wrapDom.find('div'),
						position;

					dom.each(function(i,v){
						position = flag ? that.boomPosition[i] : that.position[i] ;
						$(v).animate({left:that.width/2,top:that.height/2},50).animate({left:position.x,top:position.y}, this.boomTime);
					});
				}

		}

		var sample = Object.create(Boom);
			sample.init({
				imgDom:$('img'),
				wrapDom:$('.wrap')
			});


function draw7(id) {
    var canvas = document.getElementById(id);
    var context = canvas.getContext("2d");
    var img = new Image();
    img.onload = function(){

    	context.fillStyle = "#EEEEFF";
        context.fillRect(0, 0, 960, 640);
        //图形绘制
        // context.translate(200, 50);
        // for (var i = 0; i < 1; i++) {
            // context.translate(25, 25);
            // context.scale(0.95, 0.95);
            // context.rotate(Math.PI / 10);
            // create5Star(context);
            // context.fill();
            context.drawImage(img,0,  0,  480,320,0,  0,  480,320);
            context.drawImage(img,480,0,  480,320,480,0,  480,320);
            context.drawImage(img,480,320,480,320,480,320,480,320);
            context.drawImage(img,0,  320,480,320,0,  320,480,320);
            // context.drawImage(img,0,0,960,640);
        // }
    }
    img.src = 'img/a.jpg';     
}


window.onload = function () {
    draw7("canvas7");
}


</script>
</html>